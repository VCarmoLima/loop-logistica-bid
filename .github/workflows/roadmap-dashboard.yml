name: Roadmap Dashboard

on:
  push:
    paths:
      - "ROADMAP.md"

jobs:
  generate-dashboard:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Generate SVG Progress
        run: |
          TOTAL=$(grep -o "\- \[.\]" ROADMAP.md | wc -l)
          DONE=$(grep -o "\- \[x\]" ROADMAP.md | wc -l)

          if [ "$TOTAL" -eq 0 ]; then
            PERCENT=0
          else
            PERCENT=$((100 * DONE / TOTAL))
          fi

          BAR_WIDTH=400
          FILLED=$((BAR_WIDTH * PERCENT / 100))

          mkdir -p assets

          cat <<EOF > assets/roadmap-progress.svg
          <svg width="600" height="140" viewBox="0 0 600 140" xmlns="http://www.w3.org/2000/svg">
            <style>
              .title {
                font: 600 20px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                fill: #e5e7eb;
              }
              .subtitle {
                font: 14px system-ui, sans-serif;
                fill: #9ca3af;
              }
              .label {
                font: 13px system-ui, sans-serif;
                fill: #d1d5db;
              }
            </style>
          
            <!-- Title -->
            <text x="30" y="30" class="title">ðŸ“Š Progresso do Roadmap</text>
            <text x="30" y="52" class="subtitle">Sistema de BIDs</text>
          
            <!-- Background bar -->
            <rect x="30" y="75" width="540" height="18" rx="9" fill="#1f2933"/>
          
            <!-- Progress bar -->
            <rect x="30" y="75" width="$((540 * PERCENT / 100))" height="18" rx="9" fill="#22c55e"/>
          
            <!-- Label -->
            <text x="30" y="118" class="label">
              $DONE de $TOTAL tarefas concluÃ­das â€” $PERCENT%
            </text>
          </svg>
          EOF

          <svg width="500" height="90" viewBox="0 0 500 90" xmlns="http://www.w3.org/2000/svg">
            <style>
              .title { font: bold 18px sans-serif; fill: #111 }
              .label { font: 14px sans-serif; fill: #333 }
            </style>

            <text x="20" y="25" class="title">Roadmap Progress</text>

            <rect x="20" y="40" width="$BAR_WIDTH" height="20" rx="10" fill="#e5e7eb"/>
            <rect x="20" y="40" width="$FILLED" height="20" rx="10" fill="#22c55e"/>

            <text x="20" y="80" class="label">$DONE de $TOTAL tarefas concluÃ­das ($PERCENT%)</text>
          </svg>
          EOF

      - name: Commit SVG
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add assets/roadmap-progress.svg
          git commit -m "chore: update roadmap dashboard"
          git push
